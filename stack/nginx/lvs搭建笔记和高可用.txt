
LVSï¼š

node01:
	ifconfig  eth1:8 10.0.2.10/24
node02~node03:
	1)ä¿®æ”¹å†…æ ¸ï¼š
		echo 1  >  /proc/sys/net/ipv4/conf/eth0/arp_ignore 
		echo 1  >  /proc/sys/net/ipv4/conf/all/arp_ignore 
		echo 2 > /proc/sys/net/ipv4/conf/eth0/arp_announce 
		echo 2 > /proc/sys/net/ipv4/conf/all/arp_announce 
	2ï¼‰è®¾ç½®éšè—çš„vipï¼š
		ifconfig  lo:3  10.0.2.10  netmask 255.255.255.255
		
RSä¸­çš„æœåŠ¡ï¼š
node02~node03:
	yum install httpd -y
	service httpd start
	vi   /var/www/html/index.html
		from 192.168.150.1x

LVSæœåŠ¡é…ç½®
node01:
		yum install ipvsadm 
	ipvsadm -A  -t  10.0.2.10:80  -s rr
	ipvsadm -a  -t 10.0.2.10:80  -r  10.0.2.112 -g -w 1
	ipvsadm -a  -t 10.0.2.10:80  -r  10.0.2.113 -g -w 1
	ipvsadm -ln

éªŒè¯ï¼š
	æµè§ˆå™¨è®¿é—®  192.168.150.100   çœ‹åˆ°è´Ÿè½½  ç–¯ç‹‚F5
	node01ï¼š
		netstat -natp   ç»“è®ºçœ‹ä¸åˆ°socketè¿æ¥
	node02~node03:
		netstat -natp   ç»“è®ºçœ‹åˆ°å¾ˆå¤šçš„socketè¿æ¥
	node01:
		ipvsadm -lnc    æŸ¥çœ‹å·çª¥è®°å½•æœ¬
		TCP 00:57  FIN_WAIT    192.168.150.1:51587 192.168.150.100:80 192.168.150.12:80
		FIN_WAITï¼š è¿æ¥è¿‡ï¼Œå·çª¥äº†æ‰€æœ‰çš„åŒ…
		SYN_RECVï¼š åŸºæœ¬ä¸Šlvséƒ½è®°å½•äº†ï¼Œè¯æ˜lvsæ²¡äº‹ï¼Œä¸€å®šæ˜¯åè¾¹ç½‘ç»œå±‚å‡ºé—®é¢˜
	
	
	
	



keepalivedå®éªŒï¼š
ä¸»æœºï¼š node01~node04

node01:
	ipvsadm -C
	ifconfig eth0:8 down

----------------------------
node01,node04:
	yum install keepalived ipvsadm -y
	é…ç½®ï¼š
		cd  /etc/keepalived/
		cp keepalived.conf keepalived.conf.bak
		vi keepalived.conf
			node01:
			vrrpï¼šè™šæ‹Ÿè·¯ç”±å†—ä½™åè®®ï¼
				vrrp_instance VI_1 {
					state MASTER         //  node04  BACKUP
					interface eth0
					virtual_router_id 51    //æ³¨æ„ è¿™é‡Œä¿æŒä¸»å¤‡ä¸€è‡´ ğŸ˜¢
					priority 100		 //	 node04	 50
					advert_int 1
					authentication {
						auth_type PASS
						auth_pass 1111
					}
					virtual_ipaddress {
						10.0.2.10/24 dev eth1 label  eth1:3
					}
				}
			virtual_server 192.168.150.100 80 {
				delay_loop 6
				lb_algo rr
				lb_kind DR
				nat_mask 255.255.255.0
				persistence_timeout 0
				protocol TCP

				real_server 192.168.150.12 80 {
					weight 1
					HTTP_GET {           //æ³¨æ„è¿™é‡Œæ˜¯http
						url {
						  path /
						  status_code 200
						}
						connect_timeout 3
						nb_get_retry 3
						delay_before_retry 3
					}   
				}       
				real_server 192.168.150.13 80 {
					weight 1
					HTTP_GET {
						url {
						  path /
						  status_code 200
						}
						connect_timeout 3
						nb_get_retry 3
						delay_before_retry 3
					}
				}
			scp  ./keepalived.conf  root@node04:`pwd`



	
	
	
	
	
	